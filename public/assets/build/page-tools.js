(()=>{"use strict";document.addEventListener("DOMContentLoaded",(function(){const e=new Vue({el:"#clean-my-wordpress-app",data:{views:[{title:i18n.Home,id:"home",icon:"bi bi-house-door"},{title:i18n["Disk Explorer"],id:"disk-explorer",icon:"bi bi-hdd"}],current_view:"home",full_screen:!1,disk_explorer:{loaded:!1,parent_wp_root:php.parent_wp_root,name:"root",parent_folder:!1,path:php.wp_root,wp_root:php.wp_root,files:[],icons_urls:php.icons,focused_file:!1,selected_file:!1}},methods:{get_folder_data:function(e,t=!0){this.disk_explorer.loaded=!1,t?fetch(php.ajax_url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams({action:"cmwp_get_folder_data",nonce:php.nonce,path:e})}).then((e=>e.json())).then((e=>{e.status,e.success&&(this.disk_explorer.files=e.data.files,this.disk_explorer.name=e.data.name,this.disk_explorer.parent_folder=e.data.parent_folder,this.disk_explorer.selected_file=!1,this.disk_explorer.path=e.data.path,this.disk_explorer.loaded=!0,this.get_d3_content())})).catch((e=>{})):this.disk_explorer.loaded=!0},bytes_to_readable:function(e){if(0==e)return"0 B";let t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["B","KB","MB","GB","TB"][t]},get_file_icon:function(e){const t=this.disk_explorer.icons_urls;if(e.is_dir){if("wp-admin"==e.name||"wp-includes"==e.name)return t.folders["wp-core"];for(const i in t.folders)if(e.name==i)return t.folders[i];return t.folders.folder}{let i=e.name.split(".").pop();for(const e in t.files)if(i==e)return t.files[e];return t.files.file}},get_d3_content:function(){var t=Math.min(Math.min(window.innerWidth,window.innerHeight),600),i=d3.scaleOrdinal(d3.schemeCategory20c);d3.select("#bubble-chart").selectAll("*").remove();var n=d3.select("#bubble-chart").append("svg").attr("width",t).attr("height",t),r=d3.pack().size([t,t]).padding(.008*t),o=this.disk_explorer.files;let s=0;for(const e in o)o[e].view_size=o[e].size,o[e].view_size>s&&(s=o[e].view_size);for(const e in o)o[e].view_size<s/200&&(o[e].view_size=s/200);var a=d3.hierarchy({children:o}).sum((function(e){return e.view_size})).sort((function(e,t){return t.value-e.value})),l=n.selectAll(".node").data(r(a).leaves()).enter().append("g").attr("class","node").attr("transform",(function(e){return"translate("+e.x+","+e.y+")"}));l.append("circle").attr("id",(function(t){return e.file_name_to_id(t.data.name)})).attr("class",(function(e){return"circle-file-bubble"})).attr("r",(function(e){return e.r})).style("fill",(function(e,t){return i(t)})).on("mouseover",(function(t){d3.select(this).style("opacity",.8),e.set_focused_file(t.data)})).on("mouseout",(function(t){d3.select(this).style("opacity",1),e.set_focused_file(!1)})).on("click",(function(t){e.set_selected_file(t.data)})).on("dblclick",(function(t){t.data.is_dir&&e.get_folder_data(t.data.path)})),l.append("image").attr("xlink:href",(function(t){return e.get_file_icon(t.data)})).attr("x",(function(e){return.5*-e.r})).attr("y",(function(e){return.5*-e.r})).attr("height",(function(e){return 1*e.r})).attr("width",(function(e){return 1*e.r}))},set_focused_file:function(e){if(this.disk_explorer.focused_file=e,document.querySelectorAll(".circle-file-bubble.focused").forEach((function(e){e.classList.remove("focused")})),e){const t=this.file_name_to_id(e.name);document.getElementById(t).classList.add("focused")}},set_selected_file:function(e){if(this.disk_explorer.selected_file=e,document.querySelectorAll(".circle-file-bubble.selected").forEach((function(e){e.classList.remove("selected")})),e){const t=this.file_name_to_id(e.name);document.getElementById(t).classList.add("selected")}},file_name_to_id:function(e){return null==e?"":"file-"+e.replace(/[^a-zA-Z0-9]/g,"-")},delete_file:function(e){this.disk_explorer.loaded=!1;let t="";t=e.is_dir?i18n["Are you sure you want to delete this folder and all its content ?"]:i18n["Are you sure you want to delete this file ?"],confirm(t)?fetch(php.ajax_url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams({action:"cmwp_delete_file",nonce:php.nonce,path:e.path})}).then((e=>e.json())).then((e=>{this.disk_explorer.loaded=!0,e.status,e.success&&this.get_folder_data(this.disk_explorer.path)})).catch((e=>{})):this.disk_explorer.loaded=!0}},mounted:function(){this.get_folder_data(this.disk_explorer.path)}})}))})();